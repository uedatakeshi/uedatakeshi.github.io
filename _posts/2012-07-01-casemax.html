---
layout: post
title: 登録日と更新日のフィールドがあって、その中で一番新しい日付を一発でセレクトするクエリー（CASE文とMAX）
date: '2012-07-01T06:55:00.001+09:00'
author: 上田 剛
tags:
- Postgres
modified_time: '2012-07-01T06:55:30.409+09:00'
blogger_id: tag:blogger.com,1999:blog-2052559951721308867.post-380298435368333858
blogger_orig_url: http://uedatakeshi.blogspot.com/2012/07/casemax.html
---

<h1>登録日と更新日のフィールドがあって、その中で一番新しい日付を一発でセレクトするクエリー（CASE文とMAX）</h1><p>登録日が created で、更新日が modified で、データを新規登録した時にね、<br />
created には insert するけど、modified にはしない。<br />
本当に編集した時だけ modified に入れるようなプログラムになってたとするじゃないですか。<br />
</p><p>そうするとデータはこんな感じになる訳で。<br />
<br />
<pre class="brush: shell">          created           |          modified          
----------------------------+----------------------------
 2009-03-17 10:18:24.792449 | 2009-03-17 10:32:55.900294
 2009-03-25 19:32:18.205694 | 
 2009-03-26 14:44:18.787866 | 
 2009-03-30 16:56:56.128813 | 
 2012-06-22 18:26:11.540513 | 
 2012-06-23 12:18:09.649044 | 
 2012-06-22 18:26:37.815316 | 2012-06-26 15:07:45.34223
 2012-06-21 12:46:03.151537 | 2012-06-26 16:44:05.811683
 2012-06-26 19:05:44.473284 | 2012-06-26 20:15:18.196717
 </pre> <br />
 modified は NULL になってるデータがある訳です。</p><p>こういう状態で、更新があった一番新しい日付をセレクトせよ、ってことなんですが。。。</p> <br />
 <pre class="brush: sql"> SELECT MAX(CASE WHEN modified IS NULL THEN created ELSE modified END) AS dates FROM items;
 </pre> <br />
<p>これでこうなる。 <br />
<pre class="brush: shell">           dates            
----------------------------
 2012-06-26 20:15:18.196717
(1 row)
</pre>まあ、最初っから両方入れとけよって話ですね。</p><br />
<br />